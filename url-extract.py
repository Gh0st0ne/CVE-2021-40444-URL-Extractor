import zipfile
import sys
import magic
import re
from defang import defang

def docx():
    with open(sys.argv[1], 'rb') as f:
        zip = zipfile.ZipFile(f)
        xml = zip.read('word/document.xml')
        pattern = re.compile(r"(http|https):\/\/(?!.*(\.microsoft\.com|\.openxmlformats\.org|purl\.org|\.w3\.org)).*?(?=<\/w:t>)", re.IGNORECASE)
        print('-'*25)
        print('\tDefanged URLs:')
        print('-'*25)
        
        for url in re.finditer(pattern, str(xml)):
            print(defang(url.group(0), all_dots=True)) 


def rtf():
    with open(sys.argv[1], 'r') as f:
        text = f.read()
        pattern = re.compile(r"(http|https):\/\/(?!.*(\.microsoft\.com|\.openxmlformats\.org|purl\.org|\.w3\.org)).*?(?=})", re.IGNORECASE)
        
        print('-'*25)
        print('\tDefanged URLs:')
        print('-'*25)
        
        for url in re.finditer(pattern, text):
            print(defang(url.group(0), colon=True, all_dots=True)) 

file = magic.from_file(sys.argv[1])

if "microsoft word" in file.lower():
    docx()

if "rich text" in file.lower():
    rtf()


